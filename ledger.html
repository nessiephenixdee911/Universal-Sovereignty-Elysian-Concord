<!DOCTYPE html>
<html>
<head>
  <title>Live Vote Ledger</title>
  <style>
    body {background:#000; color:#0f0; font-family:monospace; padding:2rem}
  </style>
</head>
<body>
  <h1>LIVE GLOBAL VOTE LEDGER – Immutable Forever</h1>
  <a href="index.html">← Back to vote</a>
  <hr>
  <div id="tally" style="font-size:2rem; text-align:center; margin:2rem">Loading tally…</div>
  <div id="list"></div>
  <script>
    const SUPABASE_URL = "https://auqzjncsxxleillfnpyh.supabase.co";
    const SUPABASE_ANON_KEY = "sb_publishable_wKVt9PjkIrXGJPUezL57oQ_RM7V8Yl4";

    async function loadLedger() {
      const resp = await fetch(`${SUPABASE_URL}/rest/v1/votes?order=timestamp.desc`, {
        headers: { "apikey": SUPABASE_ANON_KEY }
      });
      const votes = await resp.json();

      let sovereignty = 0;
      let slavery = 0;
      votes.forEach(v => {
        if (v.choice === "Sovereignty") sovereignty++;
        if (v.choice === "Slavery") concord++;
      });

      document.getElementById('tally').innerText = `Tally: ${sovereignty} Sovereignty | ${slavery} Slavery`;

      const div = document.getElementById('list');
      votes.forEach((v,i) => {
        div.innerHTML += `<p>${i+1}. ${v.choice} – ${new Date(v.timestamp).toLocaleString()} – proof: ${v.proof}</p>`;
      });
      if (votes.length === 0) div.innerHTML = "<p>No votes yet.</p>";
    }

    loadLedger();
  </script>
</body>
</html>